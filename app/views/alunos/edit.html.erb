<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="card">
        <div class="card-header bg-warning">
          <h5 class="mb-0">✏️ Editar Aluno</h5>
        </div>
        <div class="card-body">
          <form action="/alunos/<%= @aluno.id %>" method="POST">
            <input type="hidden" name="_method" value="PATCH">
            <input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>">
            
            <div class="mb-3">
              <label class="form-label">Nome</label>
              <input type="text" name="aluno[nome]" class="form-control" value="<%= @aluno.nome %>" required>
            </div>

            <div class="mb-3">
              <label class="form-label">CPF</label>
              <input type="text" name="aluno[cpf]" id="cpf_input" class="form-control" value="<%= @aluno.cpf %>" required maxlength="14">
              <small class="text-muted">Apenas números (11 dígitos)</small>
            </div>

            <div class="mb-3">
              <label class="form-label">Telefone</label>
              <input type="text" name="aluno[telefone]" class="form-control" value="<%= @aluno.telefone %>">
            </div>

            <div class="mb-3">
              <label class="form-label">Data Nascimento</label>
              <input type="date" name="aluno[data_nascimento]" class="form-control" value="<%= @aluno.data_nascimento&.strftime('%Y-%m-%d') %>">
            </div>

            <div class="mb-3">
              <label class="form-label">Status</label>
              <select name="aluno[status]" class="form-select">
                <option <%= 'selected' if @aluno.status == 'ativo' %>>ativo</option>
                <option <%= 'selected' if @aluno.status == 'inativo' %>>inativo</option>
              </select>
            </div>

            <div class="mb-3">
              <label class="form-label">Plano</label>
              <select name="aluno[plano_id]" class="form-select" required>
                <% Plano.all.each do |plano| %>
                  <option value="<%= plano.id %>" <%= 'selected' if @aluno.plano_id == plano.id %>><%= plano.nome_plano %></option>
                <% end %>
              </select>
            </div>

            <div class="d-flex gap-2">
              <button type="submit" class="btn btn-primary">Salvar</button>
              <a href="/alunos" class="btn btn-secondary">Cancelar</a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function formatCpf(value) {
    value = value.replace(/\D/g, '').substring(0, 11);
    
    if (value.length > 9) {
      return value.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
    } else if (value.length > 6) {
      return value.replace(/(\d{3})(\d{3})(\d{1,3})/, '$1.$2.$3');
    } else if (value.length > 3) {
      return value.replace(/(\d{3})(\d{1,3})/, '$1.$2');
    }
    return value;
  }

  const cpfInput = document.getElementById('cpf_input');
  cpfInput.value = formatCpf(cpfInput.value);

  cpfInput.addEventListener('input', function(e) {
    e.target.value = formatCpf(e.target.value);
  });

  document.querySelector('form').addEventListener('submit', function() {
    cpfInput.value = cpfInput.value.replace(/\D/g, '');
  });
</script>
